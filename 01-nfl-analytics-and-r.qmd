# An Introduction to NFL Analytics and the R Programming Language

```{r loading-library, include = FALSE}

library(tidyverse)
library(nflverse)
library(extrafont)
```

## Introduction

It probably seems odd to jump right into coding and visualization in Chapter 1, while placing information about learning the basics of the `tidyverse` in Chapter 2. But there is good reason I adopted this pedagogical approach in this book. As explained by Hadley Wickham and Garrett Grolemund in their outstanding book [*R for Data Science*](https://r4ds.had.co.nz/index.html)*,* the process of reading in and then cleaning data is not exactly the most exciting part of doing analytics. As evidence suggest, early excitement and integration into a topic increases the likelihood of following up and learning the boring material.

Because of this, I follow the approach of Wickham and Grolemund and provide you data that is already imported and, for the most part, tidied and ready to go.

::: callout-important
I am assuming, while you may not have a full grasp of the `tidyverse` yet, **that you do currently have base R and RStudio installed**. If you do not, more detailed instructions are provided in Chapter 2. If you would rather jump right into this material, you can download base R and RStudio at the following links. Once both are installed, you can return to this point in the chapter to follow along.

To download/install base R: [cran.rstudio.com](https://cran.rstudio.com/)\
To download/install RStudio: [RStudio Desktop](https://posit.co/download/rstudio-desktop/) (scroll to bottom of page for Mac options)
:::

In this chapter, we will use data I prepared from the 2021 NFL season. **add more about what the chapter does here**.

## 2021 NFL Completion Leaders

At the conclusion of the 2021 NFL season, Tom Brady - of the Tampa Bay Buccaneers - led the league in completed pass attempts with 485, well above Justin Herbert's tally of 443 completions for second place. However, as is the case with many NFL statistics, there is much context that can be added to even an otherwise "simple statistic" such as pass completions.

For example, one may be interested in seeing the progression of completion throughout the season to witness how the "race to the top" changed from week to week. And, of course, all completions are not created equal. Was Tom Brady doing a "nickel and dime" routine down the field, thus picking up easier completions than, for example, a QB slinging it 15+ yards at a higher rate than Brady? Or what about a quarterback's time to throw? It seems logical to conclude that an under performing offensive line, providing limited time for a QB to make reads and get rid of the ball, would impact multiple parts of a QB's passing game.

To start exploring some of these questions and assumptions, lets pull the prepared data from this book's GitHub using the following code:

```{r reading-example-data, include = TRUE, output = FALSE}

completed_passes <- readr::read_csv("https://raw.githubusercontent.com/bcongelio/nfl-analytics-with-r-book/origin/example_data/completed_passes.csv")

```

::: callout-note
The `readr` package is part of the `tidyverse`. Please make sure to run `library(tidyverse)` to load both.
:::

The data is a snippet of NFL play-by-play from the `nflreadr` package with 18 variables included:

```{r completed-passes-data, include = TRUE}

colnames(completed_passes)
```

###  Week-by-Week Completed Passes

Was Tom Brady near the top of the completion leader board throughout the 2021 NFL season? Or did he perhaps jump at the leader board with an above-average number of completions in the final weeks of the season?

To answer this question, we can create a week-by-week graph after doing several basic manipulations to the data. First, the code:

```{r week-by-week-passing, include = TRUE}

week_by_week <- completed_passes %>%
  filter(season_type == "REG") %>%
  group_by(player_id) %>%
  mutate(all_completions = sum(completions, na.rm = TRUE)) %>%
  filter(all_completions >= 372) %>%
  summarize(total_completions = cumsum(completions),
            week = week,
            name = player_display_name,
            posteam = recent_team)
```

There are several things going on in the above example.

First, we are using the `filter` function from `dplyr` to calculate completed passes from just the regular season. In order to calculate for each individual quarterback, we are using the `group_by` function to lump all distinct `player_id` together. Afterwards, we are creating a new column within the data with `mutate` titled `all_completions` which is the sum of all complete passes for each quarterback. This is done in order to efficiently use the `filter` function to limit the results to just the top ten quarterbacks by total completions. Lastly, we use the `summarize` function to distill the data down to four columns. Of importance is the `total_completions` column we create using the `cumsum` function, which adds each QB's completions week-by-week for a running total. After, we grab the `week`, `name`, and `posteam` columns for the purposes of data visualization.

You can see the first ten rows of the data by simply typing the name of the dataframe and running it: `week_by_week`.

With the data manipulation complete, let's take the information and visualize it by cumulative completions by week for each quarterback. But, first, to allow for differentiation, lets bring in team colors into the dataframe using the `team_colors_logos` function within the `nflfastR` package:

```{r bringing-in-colors, include = TRUE}

week_by_week <- week_by_week %>%
  left_join(nflfastR::teams_colors_logos, by = c("posteam" = "team_abbr"))
```

By matching up the `team_abbr` listed within `teams_colors_logos` to the `posteam` in our dataframe, we are able to match each quarterback to their respective team colors, logos, and more. With that completed, we can turn to completing the data visualization:

```{r cumulative-completions-graph, include = TRUE}

ggplot(data = week_by_week, aes(x = week, y = total_completions, group = player_id)) +
  geom_line(color = week_by_week$team_color, size = 1.5) +
  geom_point(color = week_by_week$team_color2, size = 1) +
  scale_x_continuous(breaks = seq(1,18,1),
                     expand = c(0,0)) +
  scale_y_continuous(breaks = scales::pretty_breaks()) +
  theme(aspect.ratio = 9 / 16) +
  theme_bw() +
  theme(
    panel.background = element_rect(fill = "#FFFFFF"),
    plot.background = element_rect(fill = "#FFFFFF"),
    panel.border = element_rect(color = "#FFFFFF"),
    panel.grid.major = element_line(color = "#F3F3F3", size = .75),
    axis.text.x = element_text(size = 11, color = "#535353", family = "Roboto Condensed"),
    axis.text.y = element_text(size = 11, color = "#535353", family = "Roboto Condensed"),
    axis.title.y = element_text(size = 11, color = "#535353", family = "Roboto Condensed"),
    axis.title.x = element_text(size = 11, color = "#535353", family = "Roboto Condensed"),
    axis.ticks = element_blank()) +
  ylab("Total Completions") +
  xlab("Week") +
  labs(title = "Cumulative Completions per Week",
       subtitle = "2021 Season")
```

![2021 Cumulative Completions](_book/images/cumulative-completions.png){fig-align="center"}
